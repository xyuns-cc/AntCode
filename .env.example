# AntCode 环境配置文件示例
# 复制此文件为 .env 并根据需要修改

# ============ 数据库配置 ============
# 留空使用默认 SQLite（存储在 data/db/antcode.sqlite3）
DATABASE_URL=

# MySQL 示例
# DATABASE_URL=mysql+asyncmy://user:password@localhost:3306/antcode

# PostgreSQL 示例
# DATABASE_URL=postgresql://user:password@localhost:5432/antcode

# ============ Redis 配置 ============
# 留空使用内存缓存
# 格式: redis://[:password]@host:port/db
REDIS_URL=

# ============ 任务队列后端配置 ============
# 队列后端类型: "memory" (默认，零依赖) 或 "redis" (生产模式，支持多 Master)
# 使用 redis 时必须配置 REDIS_URL
QUEUE_BACKEND=memory

# ============ Worker 日志缓冲配置 ============
# 日志缓冲区大小（达到此数量触发批量发送到 Master）
LOG_BUFFER_SIZE=50
# 日志刷新间隔（秒，超过此时间自动刷新）
LOG_FLUSH_INTERVAL=2.0
# 日志缓冲区最大行数（超过则丢弃最旧日志，防止内存溢出）
LOG_BUFFER_MAX_LINES=500

# ============ Worker 项目缓存配置 ============
# 项目缓存最大数量（超过则按 LRU 策略淘汰）
PROJECT_CACHE_MAX_SIZE=100
# 项目缓存 TTL（小时，超过此时间未访问的项目标记为淘汰候选）
PROJECT_CACHE_TTL_HOURS=168

# ============ 服务器配置 ============
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
SERVER_DOMAIN=localhost

# ============ 安全配置 ============
# CORS 允许的来源（逗号分隔，生产环境请设置具体域名）
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# 是否允许连接私有网络节点（仅限内网部署时设为 true）
ALLOW_PRIVATE_NODES=false

# 是否验证告警 Webhook 的 SSL 证书（生产环境建议 true）
ALERT_VERIFY_SSL=true

# ============ 前端配置 ============
FRONTEND_PORT=3000

# ============ 日志配置 ============
LOG_LEVEL=INFO
LOG_FORMAT=text
LOG_TO_FILE=true



# ============ gRPC 配置 ============
# 是否启用 gRPC 服务（Master 与 Worker 之间的高性能通信）
GRPC_ENABLED=true
# gRPC 服务端口
GRPC_PORT=50051
# gRPC 最大工作线程数
GRPC_MAX_WORKERS=10
# gRPC 心跳间隔（秒）
GRPC_HEARTBEAT_INTERVAL=30
# gRPC 心跳超时（秒）- 超过此时间未收到心跳则标记节点离线
GRPC_HEARTBEAT_TIMEOUT=90
# gRPC 优雅关闭等待时间（秒）
GRPC_SHUTDOWN_GRACE_PERIOD=5.0
# gRPC TLS 证书路径（可选，留空使用非加密连接）
GRPC_TLS_CERT_PATH=
# gRPC TLS 密钥路径（可选）
GRPC_TLS_KEY_PATH=

# ============ gRPC 性能优化配置 ============
# 日志缓冲区最大大小（行数）- 超过则触发背压丢弃最旧日志
# 建议: 2000-5000，根据内存和延迟要求调整
GRPC_LOG_BUFFER_MAX_SIZE=2000
# 日志批次大小 - 达到此数量触发批量发送
# 建议: 50-100，较大的批次减少网络开销但增加延迟
GRPC_LOG_BATCH_SIZE=50
# 日志刷新间隔（秒）
# 建议: 0.5-2.0，较短的间隔减少延迟但增加网络开销
GRPC_LOG_FLUSH_INTERVAL=1.0
# 压缩阈值（字节）- 超过此大小的消息将被 gzip 压缩
# 建议: 1024-4096，较小的阈值增加 CPU 开销但减少网络传输
GRPC_COMPRESS_THRESHOLD=1024
# 消息发送队列大小
# 建议: 500-2000，根据消息产生速率调整
GRPC_SEND_QUEUE_SIZE=1000
# 指标延迟样本最大数量（用于计算 P95/P99 延迟）
GRPC_METRICS_MAX_LATENCY_SAMPLES=100
